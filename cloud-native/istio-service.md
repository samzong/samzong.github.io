# Istio 服务的健康诊断
![](https://cdn.nlark.com/yuque/0/2024/jpeg/343806/1735490874560-7ae90929-a5ef-4944-b371-32376b9a8215.jpeg)

## 现状

目前服务网格策略是：自动发现，只要是正常的 Kubernetes 服务，都会自动展示在服务网格的服务列表，客户的各种服务都会呈现出来。

这对于网格治理来是好事情，不过其中要处理用户不需要网格治理的部分，这里就分为三种情况：注入启用，注入禁用，未注入。

## 出发点

- 服务列表的配置检查，会对未注入启用且配置不正常的，一律标记为“异常”，这对用户来说有些 “矫枉过正”，应该对此有些细分。
- 服务在各项资源创建选择时，应该可以感知到服务当前状态。

## 优化思路

![](https://cdn.nlark.com/yuque/0/2024/jpeg/343806/1704608001797-408aac12-63b3-4dad-86d3-5e07cde31f32.jpeg)

- 第一层，先从边车注入策略上细分，明确注入禁用的，不应该标记状态为异常；因为用户不需要网格来管理，这部分应该独立出来。
	- 在所有选择服务的地方，界面上，应该展示服务的健康状态，并给予修复的调整。（这部分可以用新开页来处理）
		- 如果选择的服务是异常服务，这对用户来说是创建一个错误资源，有伤害。
- 第二层，根据注入后可用性进行标记，明确标记网格不可工作的、不符合最佳实践但仍旧可以工作的部分。
	- 这部分优化在，诊断页面，对于不是必须的，标记为可选；所有 必选项均修复后，服务状态应该是正常。
- 第三层：
	- 对于服务最近的流量状态进行展示，重要指标如下 >> 可以快捷到服务监控页面查看最近的信息
		- 监控是否正常
		- TPS
		- Error Rate
		- 请求时延